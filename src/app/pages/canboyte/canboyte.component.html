<div class="container">
  <div class="card shadow-sm" style="height: 89vh">
    <!-- Header -->
    <div
      class="card-header bg-info text-white d-flex justify-content-between align-items-center"
    >
      <h5 class="mb-0">üìã Qu·∫£n l√Ω c√°n b·ªô y t·∫ø</h5>
      <button
        class="btn btn-light btn-sm"
        data-bs-toggle="modal"
        data-bs-target="#modalCanBo"
        (click)="moFormThem()"
      >
        ‚ûï Th√™m c√°n b·ªô
      </button>
    </div>

    <!-- Body -->
    <div class="card-body d-flex flex-column" style="height: 100%">
      <!-- T√¨m ki·∫øm -->
      <div class="mb-3">
        <input
          type="text"
          class="form-control"
          placeholder="T√¨m ki·∫øm theo h·ªç t√™n ho·∫∑c s·ªë ƒëi·ªán tho·∫°i..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="filterCanBo()"
        />
      </div>

      <div class="table-responsive flex-grow-1">
        <table class="table table-bordered table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th (click)="sort('hoTen')" style="cursor: pointer">
                H·ªç t√™n
                <span *ngIf="sortKey === 'hoTen'">
                  {{ sortDirection === "asc" ? "‚Üë" : "‚Üì" }}
                </span>
              </th>
              <th (click)="sort('soDienThoai')" style="cursor: pointer">
                S·ªë ƒëi·ªán tho·∫°i
                <span *ngIf="sortKey === 'soDienThoai'">
                  {{ sortDirection === "asc" ? "‚Üë" : "‚Üì" }}
                </span>
              </th>
              <th (click)="sort('chucVu')" style="cursor: pointer">
                Ch·ª©c v·ª•
                <span *ngIf="sortKey === 'chucVu'">
                  {{ sortDirection === "asc" ? "‚Üë" : "‚Üì" }}
                </span>
              </th>
              <th (click)="sort('donViCongTac')" style="cursor: pointer">
                ƒê∆°n v·ªã c√¥ng t√°c
                <span *ngIf="sortKey === 'donViCongTac'">
                  {{ sortDirection === "asc" ? "‚Üë" : "‚Üì" }}
                </span>
              </th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let canBo of paginatedCanBo; let i = index">
              <td>{{ i + 1 + (currentPage - 1) * pageSize }}</td>
              <td>{{ canBo.hoTen }}</td>
              <td>{{ canBo.soDienThoai }}</td>
              <td>{{ canBo.chucVu }}</td>
              <td>{{ canBo.donViCongTac }}</td>
              <td>
                <button
                  class="btn btn-sm btn-outline-primary me-1"
                  (click)="suaCanBo(canBo.maCb)"
                  data-bs-toggle="modal"
                  data-bs-target="#modalCanBo"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="xoaCanBo(canBo)"
                >
                  üóëÔ∏è
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Ph√¢n trang -->
      <div
        class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top"
      >
        <div>
          Hi·ªÉn th·ªã {{ (currentPage - 1) * pageSize + 1 }} -
          {{
            currentPage * pageSize > filteredCanBo.length
              ? filteredCanBo.length
              : currentPage * pageSize
          }}
          / {{ filteredCanBo.length }} c√°n b·ªô
        </div>
        <nav>
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="changePage(currentPage - 1)">
                Previous
              </button>
            </li>
            <li
              class="page-item"
              *ngFor="let page of getPages()"
              [class.active]="page === currentPage"
            >
              <button class="page-link" (click)="changePage(page)">
                {{ page }}
              </button>
            </li>
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="changePage(currentPage + 1)">
                Next
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<!-- Modal th√™m/s·ª≠a c√°n b·ªô -->
<div class="modal fade" id="modalCanBo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <form (ngSubmit)="luuCanBo()">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            {{ isEditMode ? "S·ª≠a" : "Th√™m" }} c√°n b·ªô y t·∫ø
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">H·ªç t√™n</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="formCanBo.hoTen"
                name="hoTen"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="formCanBo.soDienThoai"
                name="soDienThoai"
                required
                pattern="^[0-9]{10}$"
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Ch·ª©c v·ª•</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="formCanBo.chucVu"
                name="chucVu"
                required
              />
            </div>

            <div class="col-12">
              <label class="form-label">ƒê∆°n v·ªã c√¥ng t√°c</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="formCanBo.donViCongTac"
                name="donViCongTac"
                required
              />
            </div>

            <!-- Danh s√°ch l·ªãch ti√™m -->
            <div class="col-12 mt-4">
              <div class="d-flex justify-content-between align-items-center">
                <h6>Danh s√°ch l·ªãch ti√™m</h6>
                <button
                  type="button"
                  class="btn btn-sm btn-success"
                  (click)="moFormThemLichTiem()"
                >
                  ‚ûï Th√™m l·ªãch ti√™m
                </button>
              </div>
              <div class="table-responsive mt-2">
                <table class="table table-bordered table-hover">
                  <thead class="table-light">
                    <tr>
                      <th>#</th>
                      <th>M√£ ng∆∞·ªùi d√πng</th>
                      <th>M√£ vaccine</th>
                      <th>M√£ ƒë·ª£t ti√™m</th>
                      <th>Ng√†y ti√™m</th>
                      <th>M≈©i th·ª©</th>
                      <th>Tr·∫°ng th√°i</th>
                      <th>H√†nh ƒë·ªông</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="
                        let lichTiem of formCanBo.lichTiems;
                        let i = index
                      "
                    >
                      <td>{{ i + 1 }}</td>
                      <td>{{ lichTiem.maNd }}</td>
                      <td>{{ lichTiem.maVac }}</td>
                      <td>{{ lichTiem.maDot }}</td>
                      <td>{{ formatDateObject(lichTiem.ngayTiem) }}</td>
                      <td>{{ lichTiem.muiThu }}</td>
                      <td>{{ lichTiem.trangThai }}</td>
                      <td>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-primary me-1"
                          (click)="suaLichTiem(lichTiem)"
                        >
                          ‚úèÔ∏è
                        </button>
                        <button
                          type="button"
                          class="btn btn-sm btn-outline-danger"
                          (click)="xoaLichTiem(lichTiem)"
                        >
                          üóëÔ∏è
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-success">üíæ L∆∞u</button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal th√™m/s·ª≠a l·ªãch ti√™m -->
<div class="modal fade" id="modalLichTiem" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <form (ngSubmit)="luuLichTiem()">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">
            {{ isEditLichTiemMode ? "S·ª≠a" : "Th√™m" }} l·ªãch ti√™m
          </h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">M√£ ng∆∞·ªùi d√πng</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="formLichTiem.maNd"
                name="maNd"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">M√£ vaccine</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="formLichTiem.maVac"
                name="maVac"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">M√£ ƒë·ª£t ti√™m</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="formLichTiem.maDot"
                name="maDot"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Ng√†y ti√™m</label>
              <input
                type="date"
                class="form-control"
                [ngModel]="formatDateObject(formLichTiem.ngayTiem)"
                (ngModelChange)="
                  formLichTiem.ngayTiem = parseDateString($event)
                "
                name="ngayTiem"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">M≈©i th·ª©</label>
              <input
                type="number"
                class="form-control"
                [(ngModel)]="formLichTiem.muiThu"
                name="muiThu"
                required
              />
            </div>

            <div class="col-md-6">
              <label class="form-label">Tr·∫°ng th√°i</label>
              <select
                class="form-control"
                [(ngModel)]="formLichTiem.trangThai"
                name="trangThai"
                required
              >
                <option value="Ch∆∞a ti√™m">Ch∆∞a ti√™m</option>
                <option value="ƒê√£ ti√™m">ƒê√£ ti√™m</option>
                <option value="H·ªßy">H·ªßy</option>
              </select>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-success">üíæ L∆∞u</button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
