<div class="container">
  <div class="card shadow-sm" style="height: 89vh">
    <!-- Header -->
    <div
      class="card-header bg-info text-white d-flex justify-content-between align-items-center"
    >
      <h5 class="mb-0">üìÖ Danh s√°ch l·ªãch ti√™m</h5>
      <button class="btn btn-light btn-sm" (click)="moPopupThem()">
        ‚ûï Th√™m l·ªãch ti√™m
      </button>
    </div>
    <!-- T√¨m ki·∫øm -->
    <div class="p-3">
      <input
        type="text"
        class="form-control"
        placeholder="üîç T√¨m ki·∫øm theo t√™n ng∆∞·ªùi d√¢n, v·∫Øc xin ho·∫∑c ƒë·ªãa ƒëi·ªÉm..."
        [(ngModel)]="tuKhoa"
        (ngModelChange)="timKiem()"
      />
    </div>

    <!-- Body -->
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th (click)="sort('ngayTiem')" style="cursor: pointer">
                Ng√†y ti√™m
                <span *ngIf="sortKey === 'ngayTiem'">{{
                  sortDirection === "asc" ? "‚Üë" : "‚Üì"
                }}</span>
              </th>
              <th (click)="sort('maVacNavigation')" style="cursor: pointer">
                V·∫Øc xin
                <span *ngIf="sortKey === 'maVacNavigation'">{{
                  sortDirection === "asc" ? "‚Üë" : "‚Üì"
                }}</span>
              </th>
              <th (click)="sort('maDotNavigation')" style="cursor: pointer">
                ƒê·ªãa ƒëi·ªÉm
                <span *ngIf="sortKey === 'maDotNavigation'">{{
                  sortDirection === "asc" ? "‚Üë" : "‚Üì"
                }}</span>
              </th>
              <th (click)="sort('maCbNavigation')" style="cursor: pointer">
                C√°n b·ªô ph·ª• tr√°ch
                <span *ngIf="sortKey === 'maCbNavigation'">{{
                  sortDirection === "asc" ? "‚Üë" : "‚Üì"
                }}</span>
              </th>
              <th (click)="sort('trangThai')" style="cursor: pointer">
                Tr·∫°ng th√°i
                <span *ngIf="sortKey === 'trangThai'">{{
                  sortDirection === "asc" ? "‚Üë" : "‚Üì"
                }}</span>
              </th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lich of lichTiemHienThi; let i = index">
              <td>{{ i + 1 + (trangHienTai - 1) * kichThuocTrang }}</td>
              <td>{{ formatDateObject(lich.ngayTiem) }}</td>
              <td>{{ lich.maVacNavigation?.tenVac }}</td>
              <td>{{ lich.maDotNavigation?.diaDiem }}</td>
              <td>{{ lich.maCbNavigation?.hoTen }}</td>
              <td>{{ lich.trangThai }}</td>
              <td>
                <button
                  class="btn btn-sm btn-primary me-2"
                  (click)="suaLich(lich)"
                >
                  ‚úèÔ∏è S·ª≠a
                </button>
                <button class="btn btn-sm btn-danger" (click)="xoaLich(lich)">
                  üóëÔ∏è Xo√°
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div
      class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top"
    >
      <div>
        Hi·ªÉn th·ªã {{ (trangHienTai - 1) * kichThuocTrang + 1 }} -
        {{
          trangHienTai * kichThuocTrang > lichTiemLoc.length
            ? lichTiemLoc.length
            : trangHienTai * kichThuocTrang
        }}
        / {{ lichTiemLoc.length }} l·ªãch ti√™m
      </div>
      <nav>
        <ul class="pagination">
          <li class="page-item" [class.disabled]="trangHienTai === 1">
            <button class="page-link" (click)="chuyenTrang(trangHienTai - 1)">
              Previous
            </button>
          </li>
          <li
            class="page-item"
            *ngFor="let page of getPages()"
            [class.active]="page === trangHienTai"
          >
            <button class="page-link" (click)="chuyenTrang(page)">
              {{ page }}
            </button>
          </li>
          <li class="page-item" [class.disabled]="trangHienTai === tongSoTrang">
            <button class="page-link" (click)="chuyenTrang(trangHienTai + 1)">
              Next
            </button>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- Modal Th√™m/S·ª≠a -->
  <div
    class="modal fade"
    id="modalLichTiem"
    tabindex="-1"
    aria-labelledby="modalLichTiemLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <form [formGroup]="lichTiemForm" (ngSubmit)="onSubmit()">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title" id="modalLichTiemLabel">
              {{ isEdit ? "S·ª≠a" : "Th√™m" }} L·ªãch Ti√™m
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              (click)="closeModal()"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="maNd" class="form-label">Ng∆∞·ªùi d√πng</label>
                <select id="maNd" formControlName="maNd" class="form-select">
                  <option
                    *ngFor="let nd of danhSachNguoiDung"
                    [value]="nd.maNd"
                  >
                    {{ nd.hoTen }}
                  </option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="maVac" class="form-label">V·∫Øc xin</label>
                <select id="maVac" formControlName="maVac" class="form-select">
                  <option *ngFor="let vac of danhSachVac" [value]="vac.maVac">
                    {{ vac.tenVac }}
                  </option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="maDot" class="form-label"
                  >ƒê·ªãa ƒëi·ªÉm (ƒê·ª£t ti√™m)</label
                >
                <select id="maDot" formControlName="maDot" class="form-select">
                  <option
                    *ngFor="let dot of danhSachDotTiem"
                    [value]="dot.maDot"
                  >
                    {{ dot.diaDiem }}
                  </option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="maCb" class="form-label">C√°n b·ªô ph·ª• tr√°ch</label>
                <select id="maCb" formControlName="maCb" class="form-select">
                  <option *ngFor="let cb of danhSachCanBo" [value]="cb.maCb">
                    {{ cb.hoTen }}
                  </option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="ngayTiem" class="form-label">Ng√†y ti√™m</label>
                <input
                  id="ngayTiem"
                  formControlName="ngayTiem"
                  type="date"
                  class="form-control"
                />
              </div>
              <div class="col-md-6">
                <label for="muiThu" class="form-label">M≈©i th·ª©</label>
                <input
                  id="muiThu"
                  formControlName="muiThu"
                  type="number"
                  min="1"
                  class="form-control"
                />
              </div>
              <div class="col-md-12">
                <label for="trangThai" class="form-label">Tr·∫°ng th√°i</label>
                <select
                  id="trangThai"
                  formControlName="trangThai"
                  class="form-select"
                >
                  <option value="Ch∆∞a ti√™m">Ch∆∞a ti√™m</option>
                  <option value="ƒê√£ ti√™m">ƒê√£ ti√™m</option>
                  <option value="H·ªßy">H·ªßy</option>
                </select>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="closeModal()"
            >
              H·ªßy
            </button>
            <button type="submit" class="btn btn-primary">
              {{ isEdit ? "L∆∞u thay ƒë·ªïi" : "Th√™m m·ªõi" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
